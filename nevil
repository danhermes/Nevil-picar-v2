#!/bin/bash

# Activate virtual environment
#source ~/Nevil-picar-v2/nevil2env/bin/activate
#deactivate
# Source ROS 2 and workspace setup
source ~/ros2_humble/install/setup.bash
source ~/Nevil-picar-v2/install/setup.bash

# Project root
PROJECT_DIR=~/Nevil-picar-v2

# Get absolute path to ros2 executable once at top
ros2_cli=$(which ros2)

# Handle custom launch logic
if [[ "$1" == "launch" ]]; then
    shift

    if [[ -z "$1" ]]; then
        echo "‚ùå Error: No launch file specified."
        exit 1
    fi

    echo "üîß Launching with: sudo env ... $ros2_cli launch $@"

    sudo env \
        "PATH=$PATH" \
        "PYTHONPATH=$PYTHONPATH" \
        "AMENT_PREFIX_PATH=$AMENT_PREFIX_PATH" \
        "LD_LIBRARY_PATH=$LD_LIBRARY_PATH" \
        "COLCON_PREFIX_PATH=$COLCON_PREFIX_PATH" \
        "ROS_DOMAIN_ID=$ROS_DOMAIN_ID" \
        "$ros2_cli" launch "$@"

else
    # Fallback passthrough to normal ros2 CLI
    "$ros2_cli" "$@"
fi




# If you don‚Äôt want to run everything with sudo, but only the real-time nodes (e.g. chrt -f calls), you could patch just those lines in the launch.py file like so:

# python
# Copy
# Edit
# cmd = [
#     'sudo', 'env', f'PATH={os.environ["PATH"]}',
#     'chrt', '-f', '85',
#     '/home/dan/ros2_humble/install/ros2cli/bin/ros2', 'run',
#     'nevil_realtime', 'rt_sensor_node',
#     # ...args
# ]