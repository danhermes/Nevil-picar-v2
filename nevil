#!/bin/bash

# Ensure PYTHON_EXECUTABLE is set to the virtualenv Python
if [[ -z "$PYTHON_EXECUTABLE" || "$PYTHON_EXECUTABLE" == "/usr/bin/python3" ]]; then
    export PYTHON_EXECUTABLE="$HOME/Nevil-picar-v2/nevil2env/bin/python"
fi

# Source ROS 2 and workspace setup if available
if [[ -f "$HOME/ros2_humble/install/setup.bash" ]]; then
    source "$HOME/ros2_humble/install/setup.bash"
fi

if [[ -f "$HOME/Nevil-picar-v2/install/setup.bash" ]]; then
    source "$HOME/Nevil-picar-v2/install/setup.bash"
fi

# Project root
PROJECT_DIR="$HOME/Nevil-picar-v2"

# Get absolute path to ros2 executable
ros2_cli=$(which ros2)

# Dispatch logic
if [[ "$1" == "launch" ]]; then
    shift
    if [[ -z "$1" ]]; then
        echo "? Error: No launch file specified."
        exit 1
    fi
    echo "? Launching with: $ros2_cli launch $@"
    "$ros2_cli" launch "$@"

elif [[ "$1" == "build" ]]; then
    shift
    echo "? Building with: colcon build $@"
    colcon build "$@"

else
    "$ros2_cli" "$@"
fi
